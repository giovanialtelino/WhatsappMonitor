@page "/singlefile"
@inject Services.ApiService apiServices

<div class="row">
    <div class="col-sm">
        
<p>Select file for upload</p>

<InputFile OnChange="HandleSelection" />

@if(status != null)
        {
        <div class="alert alert-primary" role="alert">
            @status   
        </div>
        }
    </div>
    <div class="col-sm">
        
    </div>
</div>

<div class="row">

</div>

@code {
    [Parameter]
    public int Id { get; set; }

    [Parameter]
    public string Type { get; set; }

    string status;

    async Task HandleSelection(IFileListEntry[] files)
    {
        var file = files.FirstOrDefault();

        if (file != null)
        {
            status = $"Loading file {file.Name}";

            var ms = new MemoryStream();
            await file.Data.CopyToAsync(ms);

            var content = new MultipartFormDataContent {
    { new ByteArrayContent(ms.GetBuffer()), "\"upload\"", file.Name }
    };

            var added = await apiServices.PostFile(content, Id, Type);
            status = $"{added} records were saved";

        }
    }
}